
# 今日やること

## 6月以前のデータを削除

A5SQLを使ってフィルタをかけて、CSVへのデータエクスポートを行った

> record_datetime < '2025-06-01 00:00:00'

```sql
-- 権限なのか使えなかったけど、CSVエクスポート
SELECT *
INTO OUTFILE '/path/to/backup/marketprices_backup.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
FROM marketprices
WHERE record_datetime < '2025-06-01 00:00:00';

-- 許可されたディレクトリを確認する
SHOW VARIABLES LIKE 'secure_file_priv';

-- 削除
DELETE FROM marketprices
WHERE record_datetime < '2025-06-01 00:00:00';
```

## ログに日付を出力

```ts
export const systemLogger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp({
      format: () => new Date().toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })
    }), // JSTでタイムスタンプを付与
    winston.format.printf(({ timestamp, level, message }) => {
      return `[${timestamp}] ${level}: ${message}`;
    })
  ),
  transports: [
    new winston.transports.File({ filename: path.join(process.env.LOG_DIR ?? "C:\\logs", fileName) })
  ]
});
```

## エラーログの修正

```ts
// 以下をcatch内に記述
if (error instanceof Error) {
    errorLogger.error(error.message);
} else {
    errorLogger.error(String(error));
}
```

## ログ出力を日付ごとのファイルに指定

以下のコードを実行時に呼び出し

```ts
/**
 * Loggerのファイル名を生成する関数
 */
const getFileName = () => {
  // 日付をYYYYMMDD形式で取得
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, '0');
  const dd = String(today.getDate()).padStart(2, '0');
  const dateStr = `${yyyy}${mm}${dd}`;

  // ファイル名を生成
  const fileName = `updateconfig/updateconfig_${dateStr}.log`;
  return fileName;
}
```

## イーサリアムも使ってコインチェックの取引を行う

以下パスのCOIN_TYPESにethを追加
> src\constants\index.ts

